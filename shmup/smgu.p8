pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--shoot my game up
--by esuard

function _init()
	_upd = upd_menu
	_drw = drw_menu
	
	set_menu()
end

function _update()
	_upd()
end

function _draw()
	_drw()
end
-->8
--update functions

function upd_menu()
	--title animation--
	if t_y<50 then
		t_y+=1
	end
	if t_blink<8 then
		t_blink+=1
	else
		t_blink=0
	end
	
	--launching game--
	if btnp(❎)then
		_upd=upd_game
		_drw=drw_game
		set_menu() --reset
		set_game()
	end
end

--update game--
function upd_game()
	upd_player()
	upd_stage()
end

--update player state and actions--
function upd_player()
	
	--if player dead
	if p_pv==0 then
		_upd=upd_over
	end
	
	--handle invicibility
	if(p_inv>0)then
  p_inv-=1
 end
 
 --reset sprite and speed
 p_sprite=2
 p_sx=0
 p_sy=0
 
 --handle move
 if(btn(⬅️))then
		p_sx-=2
		p_sprite=1
	end
	if(btn(➡️))then 
		p_sx+=2
		p_sprite=3
	end
	if(btn(⬆️))then
		p_sy-=2
	end
	if(btn(⬇️))then
		p_sy+=2
	end
	
	--change pos
	p_x+=p_sx
	p_y+=p_sy
	
	--lock screen
	if(p_x<0)p_x=0
	if(p_x>120)p_x=120
	if(p_y<0)p_y=0
	if(p_y>120)p_y=120
	
	--reload
	if(p_load<wpn.rate)then
		p_load+=1
	end
	
	--firing logic
	if(btnp(❎)and
	p_load==wpn.rate and
	wpn.mun!=0) then
		blt={
			x=p_x,
			y=p_y+3,
			hbox={
			x1=1,
			x2=7,
			y1=1,
			y2=7
			}
		}
		sfx(0)
		add(p_blt,blt)
		wpn.mun-=1
		p_flash=6
		p_load=0
	end
	
	--move bullets
	if(#p_blt!=0) then
		for b in all(p_blt)do
			b.y-=wpn.spd
		end
	end
	
	--remove offscreen bullets
	if#p_blt!=0then
		for b in all(p_blt)do
			if(b.y<-8)then
				del(p_blt,b)
			end
		end
	end
	
	--*todo*--
	--handle touching bullets
	--*todo*--
end

function upd_stage()
	if time_left==0then
		stage+=1
		--time_left=90
		time_left=3600
	else
		time_left-=1
	end
	if stage==5then
		_upd=upd_over
	end
end





--update game over--
function upd_over()
	_drw=drw_over
	if btnp(❎)then
		_upd=upd_menu
		_drw=drw_menu
	end
end
-->8
--draw functions

--drawn main menu--
function drw_menu()
	cls(0)
	cprint("shoot my game up",
	t_y,7)
	if t_y==50 and t_blink<5 then
		cprint("press ❎ to get started",
	t_y+10,7)
	end	
end

--draw game--
function drw_game()
	cls(1)
	drw_player()
	drw_gui()
end

--drawing player
function drw_player()
	--show player
	if not(p_inv>0and p_inv%3==0)then
		spr(p_sprite,p_x,p_y)
	end
	--show flash
	if p_flash>0 then
		circfill(p_x+3,p_y-5,p_flash,7)
		p_flash-=1
	end
	--show bullets
	if#p_blt!=0then
		for b in all(p_blt)do
			spr(16, b.x, b.y)
		end
	end
end

--drawing gui
function drw_gui()
	--life
	for i=1, 3do
		if(p_pv>=i)then
		 spr(4,90+(9*i),1)
		else
			spr(5,90+(9*i),1)
		end
	end
	
	--loadbar
	local pct = (p_load*10)/wpn.rate
	rect(106,10,118,13,9)
	rectfill(107,11,107+pct,12,8)
	
	--munitions
	print(wpn.mun.."/"..wpn.i_mun,
		106,15,9)
	--stage
	print("stage "..stage,2,2,7)
 print(flr(time_left/30),60,2,7)	
	--score
	print("score:"..p_score,2,10,9)
end


--draw gameover--
function drw_over()
	cls(2)
	
end
-->8
--init functions
function set_menu()
	t_y=-16
	t_blink=0
end

function set_game()
--global--
	stage=0
	--time_left=90--120sec *30 frames
 time_left=3600
--player variables--
	p_x=60
	p_sx=0
	p_y=110
	p_sy=0
	p_sprite=2
	p_pv=3
	p_inv=0
	p_load=0
	p_hbox={
		x1=1,
		x2=6,
		y1=0,
		y2=7
	 }
	p_blt={}
	p_flash=0
	p_score=0
	
--weapon--
	wpn={
		rate=20,
		spd=4,
		dmg=1,
		sp=16,
		mun=10,
		i_mun=10,
		}
	
--enemy variables--
	e_table={}
	e_blt={}
end
-->8
--helper functions
function cprint(_t,_y,c)
	--x=64-(#t*2)
	print(_t,64-#_t*2,_y,c)
end
__gfx__
00000000003b3000003bb3000003b300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000bbb30003bbbb30003bbb000aa009900550055000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070003dddb303bddd5b303bddd30a99999995005500500000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000377db303bd775b303bd7730a99999995000000500000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000376db303bd765b303bd7630a99999995000000500000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000355db303bd555b303bd55300a9999900500005000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000005b00000b55b00000b500000a999000050050000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000990000009900000099000000990000005500000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
099aa990000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99aaaa99002332000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9aa77aa9023bb3200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9aa77aa9023bb3200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99aaaa99002332000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
099aa990000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000077000007aa70000a99a000090090000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000777000007aa70007a99a700a9009a00900009000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000007aa70007a99a700a9009a0090000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000077700007aa70007a99a700a9009a00900009000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000077000007aa70000a99a000090090000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000037550325502a550245501e5501955014550115500e5500b550095500755005550045500455003550025500255002550025500355005550075500e5500f55000000000000000000000000000000000000
