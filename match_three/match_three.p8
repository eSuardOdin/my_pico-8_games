pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
init_game()
end

function _update()
manage_player()
f+=1
end

function _draw()
draw_board()
draw_player()
print(p.s.sel,0,61)
end
-->8
-- init functions
function init_game()
f=0
brd=init_brd()
p={x=0,y=0,s={sel=false,x=0,y=0}}
end

function init_brd()
 local board = {}
 for i=1,6 do
  board[i] = {}
  for j=1,6 do
   local col
   repeat
    col=flr(rnd(4))+1
    until not (
    (j >= 3 and col== board[i][j-1] and col==board[i][j-2]) or
    (i >= 3 and col== board[i-1][j] and col==board[i-2][j]))
     board[i][j] = col
    end
   end
   return board
end
-->8
-- update functions
function manage_player()

if p.s.sel==false then
	if btnp(‚¨ÜÔ∏è)and p.y>0then
  p.y-=1
	elseif btnp(‚¨áÔ∏è)and p.y<5then
  p.y+=1
	elseif btnp(‚û°Ô∏è)and p.x<5then
  p.x+=1
	elseif btnp(‚¨ÖÔ∏è)and p.x>0then
  p.x-=1
 elseif btnp(‚ùé) then
  p.s.sel=true
  p.s.x=p.x
  p.s.y=p.y
 end
else
 if btnp(üÖæÔ∏è)then
  p.s.sel=false
 elseif btnp(‚¨ÜÔ∏è)and p.s.y<=p.y and p.s.x==p.x then
  p.y-=1
 elseif btnp(‚¨áÔ∏è)and p.s.y>=p.y and p.s.x==p.x then
  p.y+=1
 elseif btnp(‚¨ÖÔ∏è)and p.s.x<=p.x and p.s.y==p.y then
  p.x-=1
 elseif btnp(‚û°Ô∏è)and p.s.x>=p.x and p.s.y==p.y then
  p.x+=1
 elseif btnp(‚ùé) then
 swap(p.s.x+1,p.s.y+1,p.x+1,p.y+1)
 p.s.sel=false
 end

end
end
-->8
-- draw functions
function draw_board()
cls()
local row=0
for y=1,6 do
 for x=1,6 do
  if p.s.sel and
   (
      (p.s.y+1 == y and (p.s.x+1 == x-1 or p.s.x+1 == x+1)) or
      (p.s.x+1 == x and (p.s.y+1 == y-1 or p.s.y+1 == y+1))
   ) and f%30<15then
  else
   spr(brd[x][y],(x-1)*10,(y-1)*10)
  end
 end
end
end

function draw_player()
if(p.s.sel)then
 spr(6, p.s.x*10, p.s.y*10)
end
 spr(5, p.x*10, p.y*10)
end

-->8
-- helper functions

function swap(sx,sy,dx,dy)
box=brd[dx][dy]
brd[dx][dy]=brd[sx][sy]
brd[sx][sy]=box
end
__gfx__
000000000011110000bbbb00009999000088880077777777eeeeeeee700000007777777700000000000000000000000070000000000000000000000000000000
00000000011111100bbbbbb0099999900888888070000007e000000e700000000000000000000000000000000000000070000000000000000000000000000000
0070070011111111bbbbbbbb999999998888888870000007e000000e700000000000000000000000000000000000000070000000000000000000000000000000
0007700011111111bbbbbbbb999999998888888870000007e000000e700000000000000000000000000000000000000070000000000000000000000000000000
0007700011111111bbbbbbbb999999998888888870000007e000000e700000000000000000000000000000000000000070000000000000000000000000000000
0070070011111111bbbbbbbb999999998888888870000007e000000e700000000000000000000000000000000000000070000000000000000000000000000000
00000000011111100bbbbbb0099999900888888070000007e000000e700000000000000000000000000000000000000070000000000000000000000000000000
000000000011110000bbbb00009999000088880077777777eeeeeeee700000000000000000000000777777770000000077777777000000000000000000000000
00000000000000000000000000000000000000000000000700000000000000070000000000000000000000000000000077777777000000000000000000000000
000000000011110000bbbb0000999900008888000000000700000000000000070000000000000000000000000000000000000007000000000000000000000000
00000000011111100bbbbbb009999990088888800000000700000000000000070000000000000000000000000000000000000007000000000000000000000000
00000000011111100bbbbbb009999990088888800000000700000000000000070000000000000000000000000000000000000007000000000000000000000000
00000000011111100bbbbbb009999990088888800000000700000000000000070000000000000000000000000000000000000007000000000000000000000000
00000000011111100bbbbbb009999990088888800000000700000000000000070000000000000000000000000000000000000007000000000000000000000000
000000000011110000bbbb0000999900008888000000000700000000000000070000000000000000000000000000000000000007000000000000000000000000
00000000000000000000000000000000000000007777777700000000000000070000000000000000000000000000000000000007000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0508171c0808081c0808081c0808081c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700171700000017000000170000001700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a151700000017000000170000001700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0a0a150a0a0a150a0a0a150a0a0a1500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700001700000017000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700001700000017000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700001700000017000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0a0a150a0a0a150a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
